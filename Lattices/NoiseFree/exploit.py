from sage.all import * # type: ignore
from string import printable


with open('Lattices/NoiseFree/encs2.txt', 'r') as f:
    encs2 = eval(f.read())

mat = []
vec = []
for i in range(len(encs2)):
    enc = encs2[i]  
    A = eval(enc["A"])
    mat.append(A)
    b = eval(enc["b"])
    vec.append(b)

q = 0x10001
A = Matrix(GF(q), mat) # type: ignore
Y = vector(GF(q), vec) # type: ignore
S = A.solve_right(Y)

with open('Lattices/NoiseFree/encs1.txt', 'r') as f:
    encs1 = eval(f.read())

flag = ''
for i in range(len(encs1)):
    enc = encs1[i]
    A = vector(eval(enc["A"])) # type: ignore
    b = eval(enc["b"])
    
    for c in printable:
        tmp = int(A * S + ord(c))
        if tmp == b:
            print(f'[+] found c: {c}')
            flag += c
            break
print(flag)
